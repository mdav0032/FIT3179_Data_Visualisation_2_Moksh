{
    "$schema": "https://vega.github.io/schema/vega/v5.json",
    "title": { "text": "Total Arrivals and Departures by Continent"},
    "width": 800,
    "height": 400,

    "data": [
        {
            "name": "tree_with_arrivals_data",
            "url": "https://raw.githubusercontent.com/mdav0032/FIT3179_Data_Visualisation_2_Moksh/main/data_files/Data_Extract_From_World_Development_Indicators_Modified_Arrivals.csv",
            "format": { "type": "csv" },
            "transform": [
                {
                    "type": "filter",
                    "expr": "datum['continent'] != 'Null'"
                },
                {
                    "type": "nest",
                    "keys": ["continent", "Country Name"]
                },
                {
                    "type": "treemap",
                    "field": "total_arrivals_sum",
                    "sort": { "field": "value", "order": "descending" },
                    "method": "squarify",
                    "ratio": 1.6,
                    "size": [
                        { "signal": "width" },
                        { "signal": "height" }
                    ]
                }
            ]
        },
        {
            "name": "tree_labels",
            "source": "tree_with_arrivals_data",
            "transform": [
                {
                    "type": "filter",
                    "expr": "datum['total_arrivals_sum'] > 200000000"
                }
            ]
        }
    ],

    "scales": [
        {
            "name": "color",
            "type": "ordinal",
            "domain": {"data": "tree_with_arrivals_data", "field": "continent"},
            "range": { "scheme": "category20"}
        }
    ],
    
    "marks": [
        {
            "type": "rect",
            "from": {"data": "tree_with_arrivals_data"},
            "encode": {
                "enter": {
                    "tooltip": {
                        "signal": "'Country Name: ' + datum['Country Name'] + '.   Continent: ' + datum['continent'] + '.   No. of Tourists: ' + datum['total_arrivals_sum'] + '.'"
                    }
                },
                "update": {
                    "fill": {
                        "scale": "color",
                        "field": "continent"
                    },
                    "x": {"field": "x0"},
                    "y": {"field": "y0"},
                    "x2": {"field": "x1"},
                    "y2": {"field": "y1"}
                }
            }
        },
        {
            "type": "text",
            "from": { "data": "tree_labels" },
            "encode": {
                "enter": {
                    "align": {"value": "center"},
                    "baseline": {"value": "middle"},
                    "fill": {"value": "#000"},
                    "text": { "field": "Country Name" },
                    "tooltip": {
                        "signal": "'Country Name: ' + datum['Country Name'] + '.   Continent: ' + datum['continent'] + '.   No. of Tourists: ' + datum['total_arrivals_sum'] + '.'"
                    }
                },
                "update": {
                    "x": {"signal": "0.5 * (datum.x0 + datum.x1)"},
                    "y": {"signal": "0.5 * (datum.y0 + datum.y1)"}
                }
            }
        }
    ]
}